2025-12-09 21:46:32,996 - lib.harness - INFO - Server started on port 50051
2025-12-09 21:47:02,700 - __main__ - INFO - AgentMain received SendMessage request request {
  message_id: "1"
  role: ROLE_USER
  parts {
    text: "what is 3+4"
  }
  metadata {
    fields {
      key: "user_id"
      value {
        string_value: "40"
      }
    }
    fields {
      key: "session_id"
      value {
        string_value: "5271"
      }
    }
    fields {
      key: "agent_name"
      value {
        string_value: "dice"
      }
    }
  }
}

2025-12-09 21:47:02,701 - __main__ - INFO - Mapped content: parts=[Part(
  text='what is 3+4'
)] role='user' <<
2025-12-09 21:47:02,701 - __main__ - INFO - Metadata: {'session_id': '5271', 'user_id': '40', 'agent_name': 'dice'}
2025-12-09 21:47:06,792 - grpc._server - ERROR - Exception calling application: Error 10061 connecting to localhost:6379. No connection could be made because the target machine actively refused it.
Traceback (most recent call last):
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\connection.py", line 855, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\retry.py", line 116, in call_with_retry
    return do()
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\connection.py", line 856, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\connection.py", line 1306, in _connect
    raise err
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\connection.py", line 1290, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [WinError 10061] No connection could be made because the target machine actively refused it

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\grpc\_server.py", line 608, in _call_behavior
    response_or_iterator = behavior(argument, context)
  File "c:\py_code\multi_agent\app\main.py", line 47, in SendMessage
    memory.set_user_memory(user_id, session_id, content.parts[0].text)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\py_code\multi_agent\lib\memory.py", line 19, in set_user_memory
    save_to_memory(client_id, session_id, "user: "+ memory+"\n")
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\py_code\multi_agent\lib\memory.py", line 38, in save_to_memory
    mem = r.get(key)
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\commands\core.py", line 1923, in get
    return self.execute_command("GET", name, keys=[name])
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\client.py", line 657, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\client.py", line 663, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\utils.py", line 196, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\connection.py", line 2603, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\connection.py", line 846, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\azaha\AppData\Local\Programs\Python\Python313\Lib\site-packages\redis\connection.py", line 863, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 10061 connecting to localhost:6379. No connection could be made because the target machine actively refused it.
